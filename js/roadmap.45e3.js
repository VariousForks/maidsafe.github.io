var $=window.$,d3=window.d3,document=window.document,DESKTOP_BREAKPOINT=1134,NAV_WIDTH=20*$(window).width()/100,plainData={},interval=10,targetId=null,NAV_ID="RoadmapNav",CHART_ID="RoadmapChart",SVG_ID="RoadmapSvg",SVG_BOX_GRP_ID="RoadmapSvgBoxGrp",TASK_TITLE_ID="TaskTitle",TASK_DESC_ID="TaskDesc",BREADCUM_ID="Breadcum",MOBILE_MENU_ID="Mobile_menu",MOBILE_CHART_ID="Mobile_chart",SUB_FEATURES_ID="Sub_feature",RELIED_ON_FEATURES_ID="Relied_on_features",RELY_THIS_FEATURES_ID="Rely_this_features",MVP_ID="MVP",NAV_PREFIX="NAV_",BOX_PREFIX="BOX_",ARROW_PREFIX="ARROW_",BOX_PATTERN_PREFIX="BOX_PATTERN_",CONNECTION_PREFIX="CONNECTION_",FEATURES_PREFIX="FEATURE_",EXCLUDED_TASKS=["EXTERNAL","DOWN_STREAM"],TASK_FEATURE_TYPE={SUB_FEATURES:"sub_features",RELIED_ON_FEATURES:"relied_on_features",RELY_THIS_FEATURES:"rely_this_features"},infoIconOpen='<svg class="info-icon opened" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 39 24" fill="#2A98EA" enable-background="new 0 0 39 24" ><path d="M11,17h2v-6h-2V17z M12,2C6.5,2,2,6.5,2,12s4.5,10,10,10s10-4.5,10-10S17.5,2,12,2z M12,20c-4.4,0-8-3.6-8-8s3.6-8,8-8s8,3.6,8,8S16.4,20,12,20z M11,9h2V7h-2V9z"/><polygon points="31.3,13.2 26.8,8.7 25.8,9.8 31.3,15.3 36.8,9.8 35.7,8.7 "/></svg>',infoIconClose='<svg class="info-icon closed" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 39 24" fill="#2A98EA" enable-background="new 0 0 39 24"><polygon points="31.3,11.1 35.7,15.5 36.8,14.5 31.3,9 25.8,14.5 26.8,15.5 "/><path d="M12,2.3c-5.5,0-10,4.5-10,10s4.5,10,10,10s10-4.5,10-10S17.5,2.3,12,2.3z"/><path fill="#FFFFFF" d="M11,17.3h2v-6h-2V17.3z M11,9.3h2v-2h-2V9.3z"/></svg>',TASK_STATUS={NAME:"Status_Patterns",COMPLETE:{id:"STATUS_COMPLETE",path:"14.9,4.9 7.7,12.1 4.9,9.2 3.5,10.6 7.7,14.9 16.3,6.3",color:"#FFFFFF"},COMPLETE_DARK:{id:"STATUS_COMPLETE_DARK",path:"14.9,4.9 7.7,12.1 4.9,9.2 3.5,10.6 7.7,14.9 16.3,6.3",color:"#000000"},OPEN:{id:"STATUS_OPEN",path:"M15.2,13.3l-4.5-4.5c0.4-1.1,0.2-2.5-0.7-3.4c-1-1-2.5-1.2-3.6-0.6l2.1,2.1L7,8.4L4.8,6.3C4.2,7.4,4.5,8.9,5.5,9.9c0.9,0.9,2.3,1.2,3.4,0.7l4.5,4.5c0.2,0.2,0.5,0.2,0.7,0l1.1-1.1C15.4,13.8,15.4,13.4,15.2,13.3z",color:"#FFFFFF"},OPEN_DARK:{id:"STATUS_OPEN_DARK",path:"M15.2,13.3l-4.5-4.5c0.4-1.1,0.2-2.5-0.7-3.4c-1-1-2.5-1.2-3.6-0.6l2.1,2.1L7,8.4L4.8,6.3C4.2,7.4,4.5,8.9,5.5,9.9c0.9,0.9,2.3,1.2,3.4,0.7l4.5,4.5c0.2,0.2,0.5,0.2,0.7,0l1.1-1.1C15.4,13.8,15.4,13.4,15.2,13.3z",color:"#000000"},PLANNED:{id:"STATUS_PLANNED",path:"M14.7,5.1H7.9C7,5.1,6.3,5.9,6.3,6.8v1.4h2.3c1.5,0,2.7,1.2,2.7,2.7v1.3h3.4c0.9,0,1.6-0.7,1.6-1.6V6.8C16.3,5.9,15.6,5.1,14.7,5.1zM8.7,10.1H6c-0.4,0-0.7,0.3-0.7,0.7v1c0.8,0,1.4,0.6,1.4,1.4h2c0.4,0,0.7-0.3,0.7-0.7v-1.7C9.3,10.4,9,10.1,8.7,10.1zM5.3,12.9H4.1c-0.2,0-0.4,0.2-0.4,0.4v1.2c0,0.2,0.2,0.4,0.4,0.4h1.2c0.2,0,0.4-0.2,0.4-0.4v-1.2C5.7,12.9,5.5,12.9,5.3,12.9z",color:"#FFFFFF"},PLANNED_DARK:{id:"STATUS_PLANNED_DARK",path:"M14.7,5.1H7.9C7,5.1,6.3,5.9,6.3,6.8v1.4h2.3c1.5,0,2.7,1.2,2.7,2.7v1.3h3.4c0.9,0,1.6-0.7,1.6-1.6V6.8C16.3,5.9,15.6,5.1,14.7,5.1zM8.7,10.1H6c-0.4,0-0.7,0.3-0.7,0.7v1c0.8,0,1.4,0.6,1.4,1.4h2c0.4,0,0.7-0.3,0.7-0.7v-1.7C9.3,10.4,9,10.1,8.7,10.1zM5.3,12.9H4.1c-0.2,0-0.4,0.2-0.4,0.4v1.2c0,0.2,0.2,0.4,0.4,0.4h1.2c0.2,0,0.4-0.2,0.4-0.4v-1.2C5.7,12.9,5.5,12.9,5.3,12.9z",color:"#000000"}},TASK_COLORS=["red-1","red-2","red-3","red-4","red-5","red-6","pink-1","pink-2","pink-3","pink-4","pink-5","pink-6","purple-1","purple-2","purple-3","purple-4","purple-5","purple-6","navy-1","navy-2","navy-3","navy-4","navy-5","navy-6","blue-1","blue-2","blue-3","blue-4","blue-5","blue-6","cyan-1","cyan-2","cyan-3","cyan-4","cyan-5","cyan-6","teal-1","teal-2","teal-3","teal-4","teal-5","teal-6","tangerine-1","tangerine-2","tangerine-3","tangerine-4","tangerine-5","tangerine-6","orange-1","orange-2","orange-3","orange-4","orange-5","orange-6","brown-1","brown-2","brown-3","brown-4","brown-5","brown-6","charcoal-1","charcoal-2","charcoal-3","charcoal-4","charcoal-5","charcoal-6","grey-1","grey-2","grey-3","grey-4","grey-5","grey-6","moss-1","moss-2","moss-3","moss-4","moss-5","moss-6"],BOX_PATTERN_PATH="22,0 0,22 43,22 62,0",CONNECTION_ARROW={title:"Connection_Arrows",refX:12,refY:10,markerWidth:6,markerHeight:6,fill:"none",strokeWidth:3,path:"M 0 20L 10 10 L 0 0"},CSS_CLASS={LIST_TITLE:"listTitle",LIST_BASE:"listBase",LIST_PADDING:"listPadding",LIST_CLOSED:"listClose",NAV_BASE:"roadmapNav",CHART:"roadmapChart",CHART_BASE:"roadmapChart-b",LINE:"line-",SVG:"svg-",CHART_HEADER:"roadmapChart-h",CHART_HEADER_TITLE:"roadmapChart-h-t",CHART_HEADER_DESC:"roadmapChart-h-desc",BREADCUM:"roadmapBreadcrumb",BREADCUM_ITEM:"breadcrumb-i",PROGRESSBAR_BG:"svg-blue-3",PROGRESSBAR_STRIPE:"svg-blue-2",FEATURES:"features-"},roadmapTasks=[],Roadmap=null,DEFAULT_START_DATE=null,print=function(a,b){console.log(a+" ::"),console.log(b)},Utils=function(){};Utils.parseDate=function(a){var b=function(a){return("0"+a).slice(-2)};return a instanceof Date?a=a.getFullYear()+"-"+b(a.getMonth()+1)+"-"+b(a.getDate()):(a=a.split("-"),a[1]=b(a[1]),a[2]=b(a[2]),a=a.join("-")),a},Utils.addDate=function(a,b){if(isNaN(b))throw"value is not Numeric";var c=new Date(Utils.parseDate(a)),d=new Date(c.getTime()+24*parseInt(b)*60*60*1e3);return Utils.parseDate(d)},Utils.subDate=function(a,b){if(isNaN(b))throw"value is not Numeric";var c=new Date(Utils.parseDate(a)),d=new Date(c.getTime()-24*parseInt(b)*60*60*1e3);return Utils.parseDate(d)},Utils.getTask=function(a){var b=null;return d3.map(roadmapTasks,function(c){c.id===a&&(b=c)}),b},Utils.addSvgClass=function(a,b){var c=$(a).attr("class");if(c){var d=c.split(" ");-1===d.indexOf(b)&&(d.unshift(b),$(a).attr("class",d.join(" ")))}},Utils.removeSvgClass=function(a,b){var c=$(a).attr("class");if(c){var d=c.split(" ");-1!==d.indexOf(b)&&(d.splice(d.indexOf(b),1),$(a).attr("class",d.join(" ")))}},Utils.textEllipsis=function(a,b){return b=b||0,b<a.length?a.slice(0,b)+"...":a},Utils.truncateBoxText=function(a){var b=Utils.getTask(a.taskId);if(b){var c=b.name,d=4,e=Math.floor($(Utils.parseId(a.id)).children(".box").attr("width")),f=Math.floor($(Utils.parseId(a.id)).children(".statusBox").attr("width")),g=7,h=Math.floor(e/g)-Math.floor(f/g)-d,i=c.slice(0,h);return c.length>i.length&&(i+="..."),i}},Utils.createDiv=function(a,b,c){a=a||"",c=c||"";var d="object"==typeof b?b.join(" "):"",e='<div id="::id::" class="::class::">::text::</div>';return e=e.replace("::id::",a).replace("::class::",d).replace("::text::",c),$(e)},Utils.parseId=function(a){return a?0===a.indexOf("#")?a:"#"+a:void 0},Utils.setLocationHash=function(a){a&&window.location.assign("#"+a.toLowerCase())},Utils.getLocationHash=function(){return window.location.hash.toUpperCase().replace("#","")},Utils.resetLocationHash=function(){window.location.hash=""},Utils.isDesktopScreen=function(){return $(window).width()>DESKTOP_BREAKPOINT},Utils.getChildrenTasks=function(a){var b=[];return d3.map(roadmapTasks,function(c){c.isExcluded()||c.parent&&c.parent.id===a&&b.unshift(c)}),b},Utils.getMarkerArrowLevel=function(a,b){var c=a,d=parseInt(a.slice(-1));return d=b?d-1:d,c=c.slice(0,c.length-1)+d,"url(#"+ARROW_PREFIX+c+")"},Utils.resetStartDate=function(){d3.map(roadmapTasks,function(a,b){a.startDate=Utils.parseDate(DEFAULT_START_DATE),a.endDate=roadmapTasks[b].startDate,roadmapTasks[b]=a})},Utils.getColorLevelDown=function(a){if(!a)throw"Invalid color";var b=parseInt(a.slice(-1));return a.slice(0,-1)+(b+1)};var init=function(a){a||(a=new Roadmap({payload:plainData,interval:interval,target:targetId}));var b=0;$(window).on("load",function(){b=$(window).width()}),$(window).on("hashchange",function(){var b=Utils.getLocationHash();a.drawChart(b),a.updateNav(b)}),$(window).bind("resize",function(){b!==$(window).width()&&(window.RT&&clearTimeout(window.RT),window.RT=setTimeout(function(){a.draw()},200))})},Connection=function(a,b){this.sourceId=b,this.targetId=a,this.id=CONNECTION_PREFIX+a+"_"+b,this.start={x:0,y:0},this.interStart={x:0,y:0},this.interEnd={x:0,y:0},this.end={x:0,y:0},this.color=""};Connection.prototype.setPath=function(a,b,c,d){var e=this;e.start=a,e.interStart=b,e.interEnd=c,e.end=d},Connection.prototype.setColor=function(a){this.color=a};var TaskFeature=function(a,b){this.id=FEATURES_PREFIX+a,this.taskId=a,this.type=b};TaskFeature.prototype.onClick=function(){var a=this;return function(){var b=a.taskId,c=Utils.getTask(a.taskId);c.isExcluded()&&(b=c.source),Utils.getChildrenTasks(b).length>0&&(Utils.setLocationHash(b),$(window).scrollTop(0))}};var TaskNav=function(a,b){this.taskId=a,this.id=NAV_PREFIX+a,this.isRoot=b};TaskNav.prototype.onClick=function(){var a=this;return function(b){b.stopPropagation(),a.mouseClick(this,!0)}},TaskNav.prototype.onMouseOver=function(){var a=this;return function(b){b.stopPropagation(),a.mouseOver(this);var c=Utils.getTask(a.taskId);c.box.mouseOver()}},TaskNav.prototype.onMouseOut=function(){var a=this;return function(b){b.stopPropagation(),a.mouseOut(this);var c=Utils.getTask(a.taskId);c.box.mouseOut()}},TaskNav.prototype.mouseOut=function(a){var b=this;a||(a=Utils.parseId(b.id)),$(a).removeClass("highlight");var c=Utils.getLocationHash(),d=Utils.getTask(c);$(Utils.parseId(d.nav.id)).addClass("highlight")},TaskNav.prototype.mouseOver=function(a){var b=this;a||(a=Utils.parseId(b.id)),$(a).addClass("highlight")},TaskNav.prototype.mouseClick=function(a,b){var c=this;if(a||(a=Utils.parseId(c.id)),c.isRoot)$(a).children().addClass(CSS_CLASS.LIST_CLOSED);else{$(a).siblings().addClass(CSS_CLASS.LIST_CLOSED),$(a).children("."+CSS_CLASS.LIST_BASE).addClass(CSS_CLASS.LIST_CLOSED);for(var d=$(a).parent();d&&d.hasClass("listBase");)d.removeClass(CSS_CLASS.LIST_CLOSED),d.siblings().addClass(CSS_CLASS.LIST_CLOSED),d=$(d).parent();$(a).removeClass(CSS_CLASS.LIST_CLOSED),$(".listBase").removeClass("highlight"),$(a).addClass("highlight")}b&&Utils.setLocationHash(c.taskId),$(window).scrollTop(0)};var TaskBox=function(a){this.taskId=a,this.id=BOX_PREFIX+a,this.x=0,this.y=0,this.width=0,this.statusX=0,this.childrenCount=0};TaskBox.prototype.setParams=function(a,b,c,d,e){var f=this;f.x=a,f.y=b,f.width=c,f.statusX=d,f.childrenCount=e},TaskBox.prototype.onClick=function(){var a=this;return function(){Utils.setLocationHash(a.taskId),$(window).scrollTop(0)}},TaskBox.prototype.onMouseOver=function(){var a=this;return function(){a.mouseOver()}},TaskBox.prototype.onMouseOut=function(){var a=this;return function(){a.mouseOut()}},TaskBox.prototype.mouseOver=function(){var a=this,b=Utils.getTask(a.taskId);b.nav.mouseOver(),Utils.addSvgClass(Utils.parseId(a.id),"highlight"),d3.map(b.target,function(b){var c=Utils.getTask(b);c&&d3.map(c.connections,function(b){if(b.sourceId===a.taskId){var c=Utils.parseId(b.id);Utils.addSvgClass(c,"highlight"),$(c).attr("marker-start",Utils.getMarkerArrowLevel(b.color,!0))}})}),d3.map(b.connections,function(a){var b=Utils.getTask(a.sourceId);b.isDownStream()&&Utils.addSvgClass(Utils.parseId(a.id),"highlight")})},TaskBox.prototype.mouseOut=function(){var a=this,b=Utils.getTask(a.taskId);b.nav.mouseOut(),Utils.removeSvgClass(Utils.parseId(a.id),"highlight"),d3.map(b.target,function(b){var c=Utils.getTask(b);c&&d3.map(c.connections,function(b){if(b.sourceId===a.taskId){var c=Utils.parseId(b.id);Utils.removeSvgClass(c,"highlight"),$(c).attr("marker-start",Utils.getMarkerArrowLevel(b.color,!1))}})}),d3.map(b.connections,function(a){var b=Utils.getTask(a.sourceId);b.isDownStream()&&Utils.removeSvgClass(Utils.parseId(a.id),"highlight")})};var Task=function(a,b,c){this.name=a.name,this.id=a.id,this.desc=a.desc,this.parent=b,this.target=a.target,this.source=a.source||null,this.color=a.color,this.status=a.status,this.startDate=Utils.parseDate(a.startDate),this.daysCompleted=a.daysCompleted||0,this.inProgress=a.inProgress||0,this.planned=a.planned||0,this.order=a.order||1,this.section=a.section||1,this.offset=a.offset||0,this.nav=new TaskNav(this.id,c),this.box=new TaskBox(this.id),this.connections=[]};Task.prototype.isExcluded=function(){var a=this;return-1!==EXCLUDED_TASKS.indexOf(a.name)},Task.prototype.isExternal=function(){var a=this;return EXCLUDED_TASKS[0]===a.name},Task.prototype.isDownStream=function(){var a=this;return EXCLUDED_TASKS[1]===a.name},Roadmap=function(a){this.plainData=plainData=a.data,this.targetId=targetId=a.target,this.interval=interval=a.interval,this.dateFormat=d3.time.format("%Y-%m-%d"),this.startDates=[],this.sectionCurrentIncomingCounts=[],this.activeTasks=[],this.downStreamCounts=[],this.svg={width:0,height:600,padding:20},this.progressBar={height:10},this.box={width:0,height:22,strokeWidth:2,strokeDasharray:5},this.label={width:85,height:15,padding:8,borderRadius:7}},Roadmap.prototype.getPerUnit=function(){var a=this,b=a.activeTasks[0];return a.timeScale(a.dateFormat.parse(b.startDate))-a.timeScale(a.dateFormat.parse(Utils.subDate(b.startDate,1)))},Roadmap.prototype.prepareTasks=function(){var a=this,b=function(a){a.hasOwnProperty("children")&&d3.map(a.children,function(c){roadmapTasks.push(new Task(c,Utils.getTask(a.id),!1)),c.hasOwnProperty("children")&&b(c)})};roadmapTasks=[],roadmapTasks.push(new Task(a.plainData,null,!0)),b(plainData),print("Task",roadmapTasks)},Roadmap.prototype.timeScale=function(a){var b=this;return d3.time.scale().domain([d3.min(b.activeTasks,function(a){return b.dateFormat.parse(a.startDate)}),d3.max(b.activeTasks,function(a){return b.dateFormat.parse(a.endDate)})]).range([0,b.svg.width-2*b.svg.padding])(a)},Roadmap.prototype.setNav=function(){var a=this,b=function(){var b=Utils.createDiv(null,[CSS_CLASS.NAV_BASE]),c=Utils.createDiv(NAV_ID,["roadmapNav-b"]);$(Utils.parseId(a.targetId)).append(b.append(c))},c=function(a){if(!a.isExcluded()&&-1===a.id.indexOf(MVP_ID)){var b=$(a.parent?Utils.parseId(a.parent.nav.id):Utils.parseId(NAV_ID)),c=[a.color];a.nav.isRoot?c.push(CSS_CLASS.LIST_TITLE):(b.addClass(CSS_CLASS.LIST_CLOSED),c.push(CSS_CLASS.LIST_BASE));var d=Utils.createDiv(a.nav.id,c);d.append('<span class="'+CSS_CLASS.LIST_PADDING+'">'+a.name+"</span>"),Utils.getChildrenTasks(a.id).length>1&&d.on("click",a.nav.onClick()),d.on("mouseover",a.nav.onMouseOver()),d.on("mouseout",a.nav.onMouseOut()),b.append(d)}};b(),d3.map(roadmapTasks,c)},Roadmap.prototype.prepareChart=function(){var a=this,b=null,c=function(){var b=Utils.createDiv(null,[CSS_CLASS.CHART]),c=Utils.createDiv(CHART_ID,[CSS_CLASS.CHART_BASE]);$(Utils.parseId(a.targetId)).append(b.append(c)),NAV_WIDTH=20*$(window).width()/100,a.svg.width=$(window).width()-NAV_WIDTH-1},d=function(){b=d3.selectAll(Utils.parseId(CHART_ID)).append("svg").attr("id",SVG_ID).attr("width",a.svg.width).attr("height",a.svg.height).attr("class","roadmapSvg").append("g").attr("id",SVG_BOX_GRP_ID).attr("transform","translate("+a.svg.padding+", "+a.svg.padding+")")},e=function(){var b=d3.select(Utils.parseId(SVG_ID));b.append("svg:pattern").attr("id",TASK_STATUS.COMPLETE.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("polygon").attr("fill",TASK_STATUS.COMPLETE.color).attr("points",TASK_STATUS.COMPLETE.path),b.append("svg:pattern").attr("id",TASK_STATUS.COMPLETE_DARK.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("polygon").attr("fill",TASK_STATUS.COMPLETE_DARK.color).attr("points",TASK_STATUS.COMPLETE_DARK.path),b.append("svg:pattern").attr("id",TASK_STATUS.OPEN.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("path").attr("fill",TASK_STATUS.OPEN.color).attr("d",TASK_STATUS.OPEN.path),b.append("svg:pattern").attr("id",TASK_STATUS.OPEN_DARK.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("path").attr("fill",TASK_STATUS.OPEN_DARK.color).attr("d",TASK_STATUS.OPEN_DARK.path),b.append("svg:pattern").attr("id",TASK_STATUS.PLANNED.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("path").attr("fill",TASK_STATUS.PLANNED.color).attr("d",TASK_STATUS.PLANNED.path),b.append("svg:pattern").attr("id",TASK_STATUS.PLANNED_DARK.id).attr("patternUnits","objectBoundingBox").attr("width",a.box.height).attr("height",a.box.height).append("path").attr("fill",TASK_STATUS.PLANNED_DARK.color).attr("d",TASK_STATUS.PLANNED_DARK.path)},f=function(){d3.select(Utils.parseId(SVG_ID)).selectAll("marker").data(TASK_COLORS).enter().append("svg:marker").attr("id",function(a){return ARROW_PREFIX+a}).attr("class",function(a){return CSS_CLASS.LINE+a}).attr("viewBox","0 0 20 20").attr("refX",CONNECTION_ARROW.refX).attr("refY",CONNECTION_ARROW.refY).attr("markerUnits","strokeWidth").attr("markerWidth",CONNECTION_ARROW.markerWidth).attr("markerHeight",CONNECTION_ARROW.markerHeight).attr("fill",CONNECTION_ARROW.fill).append("svg:path").attr("stroke-width",CONNECTION_ARROW.strokeWidth).attr("d",CONNECTION_ARROW.path)},g=function(){var a=Utils.createDiv(null,[CSS_CLASS.CHART_HEADER]),b=Utils.createDiv(null,[CSS_CLASS.CHART_HEADER_TITLE]),c=Utils.createDiv(TASK_TITLE_ID,[]),d=Utils.createDiv(null,[CSS_CLASS.CHART_HEADER_DESC]),e=Utils.createDiv(TASK_DESC_ID),f=Utils.createDiv(MOBILE_MENU_ID,["roadmapChart-h-menu"]);a.append(f),b.append(infoIconOpen),b.append(infoIconClose),a.append(b.append(c)),a.append(d.append(e)),$(Utils.parseId(CHART_ID)).append(a),b.on("click",function(a){a.stopPropagation(),$(this).toggleClass("active")}),f.on("click",function(a){a.stopPropagation(),$(Utils.parseId(NAV_ID)).parent().addClass("open")}),$(".roadmapNav").on("click",function(a){a.stopPropagation(),a.target===this&&$(this).removeClass("open")})},h=function(){var a=Utils.createDiv(BREADCUM_ID,[CSS_CLASS.BREADCUM]);$(Utils.parseId(CHART_ID)).append(a)};c(),h(),g(),d(),e(),f(),a.isChartReady=!0},Roadmap.prototype.updateBreadcum=function(a){var b=[],c=$(Utils.parseId(BREADCUM_ID)),d=function(){c.html("")},e=function(a){var b=null;return d3.map(roadmapTasks,function(c){c&&c.id===a.id&&(b=c.parent)}),b},f=function(a){b.push(a);var c=e(a);c&&f(c)};d(),f(a),b.reverse();var g=null;d3.map(b,function(a){g=Utils.createDiv(null,[CSS_CLASS.BREADCUM_ITEM],a.name),g.on("click",function(){Utils.setLocationHash(a.id)}),c.append(g)})},Roadmap.prototype.updateChartHeader=function(a){$(Utils.parseId(TASK_TITLE_ID)).text(a.name).parent().removeClass().addClass(a.color+" text roadmapChart-h-t"),$(Utils.parseId(TASK_DESC_ID)).text(a.desc);var b=Utils.getTask(Utils.getLocationHash());b&&0===Utils.getChildrenTasks(b.id).length&&$(Utils.parseId(TASK_TITLE_ID)).parent().addClass("active")},Roadmap.prototype.updateSvgDimensions=function(){var a=this,b=500,c=null;c=setTimeout(function(){$(".roadmapNav").css("min-height",0);var d=$(".roadmapNav").height(),e=$(Utils.parseId(SVG_BOX_GRP_ID))[0].getBoundingClientRect().height;a.svg.width=$(window).width()-NAV_WIDTH-2,a.svg.height=e>d?e:d,a.svg.height<b&&(a.svg.height=b);var f=$(Utils.parseId(SVG_ID))[0];f.setAttribute("width",a.svg.width),f.setAttribute("height",a.svg.height),Utils.isDesktopScreen()&&$(".roadmapNav").css("min-height",a.svg.height+70),clearTimeout(c),a.addLegend(),Utils.isDesktopScreen()&&($(".root").css("min-height",0),$(".root").css("min-height",$(document).height()-$("footer").height()))},200)},Roadmap.prototype.addLegend=function(){var a=this,b=d3.select(Utils.parseId(SVG_ID)).select("g");b.append("pattern").attr("id","completedLegend").attr("patternUnits","objectBoundingBox").attr("width","30").attr("height","30").append("image").attr("xlink:href","./img/roadmap_legends/key_complete.svg").attr("x","0").attr("y","0").attr("width","30").attr("height","30"),b.append("pattern").attr("id","plannedLegend").attr("patternUnits","objectBoundingBox").attr("width","30").attr("height","30").append("image").attr("xlink:href","./img/roadmap_legends/key_planned.svg").attr("x","0").attr("y","0").attr("width","30").attr("height","30"),b.append("pattern").attr("id","inProgressLegend").attr("patternUnits","objectBoundingBox").attr("width","30").attr("height","30").append("image").attr("xlink:href","./img/roadmap_legends/key_in_progress.svg").attr("x","0").attr("y","0").attr("width","30").attr("height","30"),b.append("rect").attr("x",0).attr("y",a.svg.height-110).attr("width",30).attr("height",30).attr("fill","url(#completedLegend)"),b.append("text").text("Complete").attr("x",40).attr("y",a.svg.height-90).attr("style","font-size: 13px;fill: #616161;font-weight: 600;"),b.append("rect").attr("x",0).attr("y",a.svg.height-80).attr("width",30).attr("height",30).attr("fill","url(#inProgressLegend)"),b.append("text").text("In Progress").attr("x",40).attr("y",a.svg.height-60).attr("style","font-size: 13px;fill: #616161;font-weight: 600;"),b.append("rect").attr("x",0).attr("y",a.svg.height-50).attr("width",30).attr("height",30).attr("fill","url(#plannedLegend)"),b.append("text").text("Planned").attr("x",40).attr("y",a.svg.height-30).attr("style","font-size: 13px;fill: #616161;font-weight: 600;")},Roadmap.prototype.defineBoxPattern=function(a){var b=this,c=BOX_PATTERN_PREFIX+a.name;if(!$(Utils.parseId(c)).is("pattern")){var d=d3.select(Utils.parseId(SVG_ID)).select("g").append("pattern").attr("id",c).attr("x",a.x).attr("y",a.y).attr("width",80).attr("height",b.box.height).attr("patternUnits","userSpaceOnUse").append("g");d.append("rect").attr("x",0).attr("y",0).attr("class",a.className).attr("width",a.width).attr("height",a.height).attr("opacity",.8),d.append("polygon").attr("class",a.className).attr("points",BOX_PATTERN_PATH)}},Roadmap.prototype.drawProgressBar=function(a){var b=this;if(a.daysCompleted){b.defineBoxPattern({name:a.id,x:0,y:-b.svg.padding,width:b.svg.width-2*b.svg.padding,height:b.progressBar.height,className:CSS_CLASS.SVG+a.color});var c=d3.select(Utils.parseId(SVG_BOX_GRP_ID)).append("g").attr("class","progressBar"),d=b.svg.width-2*b.svg.padding,e=d*a.daysCompleted/100,f=d*a.inProgress/100,g=d*a.planned/100;c.append("rect").attr("class",CSS_CLASS.SVG+a.color).attr("x",e+f).attr("y",-b.svg.padding).attr("width",g).attr("height",b.progressBar.height).attr("opacity",.8),c.append("rect").attr("class","chart-progress-b").attr("x",e).attr("y",-b.svg.padding).attr("width",f).attr("height",b.progressBar.height).attr("style","fill: url("+Utils.parseId(BOX_PATTERN_PREFIX+a.id)+")"),c.append("rect").attr("class",CSS_CLASS.SVG+a.color).attr("x",0).attr("y",-b.svg.padding).attr("width",e).attr("height",b.progressBar.height)}},Roadmap.prototype.drawBoxes=function(){var a=this,b=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),c=d3.select(Utils.parseId(SVG_ID)).select("g").selectAll("rect").data(a.activeTasks).enter();c.append("defs").each(function(b){b.isExcluded()||(b.status||a.defineBoxPattern({name:b.id,x:b.box.x,y:b.box.y,width:b.box.width,height:a.box.height,className:CSS_CLASS.SVG+b.color}),$(this).remove())});var d=c.append("g").attr("class",function(a){return-1!==a.id.indexOf(MVP_ID)?"boxBase mvp":"boxBase svg-"+a.color}).attr("id",function(a){return a.box.id});d.each(function(c){var d=d3.select(this);if(-1!==c.id.indexOf(MVP_ID)){var e=5;return void d.append("path").datum([{x:c.box.x,y:c.box.y+a.box.height/2},{x:c.box.x+e+a.box.height/2,y:c.box.y-e},{x:c.box.x+a.box.height+2*e,y:c.box.y+a.box.height/2},{x:c.box.x+e+a.box.height/2,y:c.box.y+a.box.height+e},{x:c.box.x,y:c.box.y+a.box.height/2}]).attr("d",b).attr("class","mvpbox")}if(d.on("mouseover",c.box.onMouseOver()),c.box.childrenCount>1&&d.on("click",c.box.onClick()),d.on("mouseout",c.box.onMouseOut()),!(c.box.childrenCount<=1))for(var f=(c.box.width-4*(c.box.childrenCount+1))/c.box.childrenCount,g={x:0,y:0},h={x:0,y:0},i={x:0,y:0},j=0;j<c.box.childrenCount;j++)h.x=(0===j?c.box.x:g.x)+4,h.y=c.box.y+a.box.height+a.box.strokeWidth+3,i.x=h.x+f,i.y=h.y,g=i,d.append("path").datum([h,i]).attr("d",b).attr("stroke-width",5).attr("class",CSS_CLASS.LINE+Utils.getColorLevelDown(c.color))}),d.append("rect").attr("x",function(a){return a.box.x}).attr("y",function(a){return a.box.y}).attr("width",function(a){return a.box.width}).attr("height",a.box.height).attr("class","box").attr("style",function(a){return a.status?void 0:"fill: url("+Utils.parseId(BOX_PATTERN_PREFIX+a.id)+")"}).attr("stroke","none").attr("stroke-dasharray",function(b){return 2===b.status?a.box.strokeDasharray:"none"}).attr("opacity",function(a){return 2===a.status?.8:-1!==a.id.indexOf(MVP_ID)?0:1}),d.append("rect").attr("x",function(b){return-1!==b.id.indexOf(MVP_ID)?b.box.x+6*a.box.height+16:b.box.statusX}).attr("y",function(b){return 1!==a.activeTasks.length?b.box.y:0}).attr("width",a.box.height).attr("height",a.box.height).attr("class","statusBox").style("fill",function(a){return-1!==a.id.indexOf(MVP_ID)?"url("+Utils.parseId(TASK_STATUS.OPEN_DARK.id)+")":0===a.status?"url("+Utils.parseId(TASK_STATUS.OPEN.id)+")":1===a.status?"url("+Utils.parseId(TASK_STATUS.COMPLETE.id)+")":2===a.status?"url("+Utils.parseId(TASK_STATUS.PLANNED.id)+")":void 0}).attr("opacity",function(a){return-1!==a.id.indexOf(MVP_ID)?0:1}),d.append("text").text(function(a){return-1!==a.id.indexOf(MVP_ID)?a.name:Utils.truncateBoxText(a.box)}).attr("x",function(b){return-1!==b.id.indexOf(MVP_ID)?b.box.x+a.box.height+16:a.box.height/2+b.box.x}).attr("y",function(b){return b.box.y+a.box.height/1.3}).attr("class","taskText").style("fill",function(a){return-1!==a.id.indexOf(MVP_ID)?"#000000":""})},Roadmap.prototype.prepareBoxes=function(a){var b=this,c=function(){d3.map(b.activeTasks,function(a){if(a.isDownStream()){var c=Utils.getTask(a.target[0]);b.downStreamCounts[c.section]?b.downStreamCounts[c.section]+=1:b.downStreamCounts[c.section]=1}})},d=function(a){var b=[];return d3.map(roadmapTasks,function(c){-1!==c.target.indexOf(a.id)&&b.push(c)}),b},e=function(a){var c=0,e=[];return d3.map(b.activeTasks,function(b){b.section===a&&(e=d(b),b.incomingTasks=e,c+=e.length)}),c},f=function(){var a=null;d3.map(roadmapTasks,function(c){if(!b.startDates[c.section-1]){a=1===c.section?c.startDate:Utils.addDate(b.startDates[c.section-2],b.interval);var d=b.downStreamCounts[c.section-1]?b.downStreamCounts[c.section-1]:0,f=e(c.section);b.startDates[c.section-1]=Utils.addDate(a,f+c.target.length+d)}})},g=function(){var c=[];return d3.map(roadmapTasks,function(b){b.parent&&b.parent.id===a.id&&c.push(b)}),0===c.length?b.activeTasks.push(a):void(b.activeTasks=c)},h=function(){var a=18;d3.map(roadmapTasks,function(c){var d=b.timeScale(b.dateFormat.parse(c.startDate)),e=b.timeScale(b.dateFormat.parse(c.endDate)),f=(c.order-1)*b.box.height*2+a;1===b.activeTasks.length&&(f=a),c.box.setParams(d,f,e-d,e-b.box.height,Utils.getChildrenTasks(c.id).length)})};g(a),c(),f(),d3.map(roadmapTasks,function(a){a.startDate=b.startDates[a.section-1],a.endDate=Utils.addDate(a.startDate,b.interval)}),h(),b.drawBoxes()},Roadmap.prototype.drawLabel=function(a){var b=this,c=d3.select(Utils.parseId(SVG_BOX_GRP_ID)),d=c.append("g").attr("class","connection-label");d.append("rect").attr("rx",b.label.borderRadius).attr("ry",b.label.borderRadius).attr("x",a.x).attr("y",a.y).attr("width",b.label.width).attr("height",b.label.height).attr("stroke-width",function(){return a.stroke?b.box.strokeWidth:0}).attr("style","font-size: 12px").attr("class",function(){var b=CSS_CLASS.SVG+a.className;return a.stroke&&(b+=" "+(CSS_CLASS.LINE+a.stroke)),b}),d.append("text").text(Utils.textEllipsis(a.desc,7)).attr("x",a.x+b.label.padding/1.3).attr("y",a.y+b.label.height/1.3).attr("class","labelText"),d.on("click",function(){Utils.setLocationHash(a.source)})},Roadmap.prototype.drawConnections=function(){var a=this,b=d3.svg.line().x(function(a){return a.x}).y(function(a){return a.y}).interpolate("linear"),c=function(a){var c=[a.start,a.interStart,a.interEnd,a.end];d3.select(Utils.parseId(SVG_ID)).select("g").datum(c).append("path").attr("id",a.id).attr("class",CSS_CLASS.LINE+a.color).attr("d",b).attr("fill","none").attr("stroke-width",2).attr("marker-start",function(){var b=Utils.getTask(a.sourceId);if(b.isDownStream())return null;var c=a.color?"url(#"+ARROW_PREFIX+a.color+")":"url(#"+ARROW_PREFIX+")";return c})};d3.map(a.activeTasks,function(a){0!==a.connections.length&&d3.map(a.connections,function(a){$(Utils.parseId(a.id)).is("path")||c(a)})})},Roadmap.prototype.prepareConnections=function(){var a=this;if(1!==a.activeTasks.length){var b=function(a){var b=[],c=[];if(a){var d=a.incomingTasks;return d3.map(d,function(d){d.order>a.order?c.unshift(d):b.unshift(d)}),c.sort(function(a,b){return a.order-b.order}),b.sort(function(a,b){return a.order-b.order}),{lowerTasks:c,upperTasks:b}}},c=function(b){var c=b.section-1;isNaN(a.sectionCurrentIncomingCounts[c])?a.sectionCurrentIncomingCounts[c]=1:a.sectionCurrentIncomingCounts[c]+=1};d3.map(a.activeTasks,function(d){var e=d.section-1,f=b(d),g=function(a,b,c,e,f,g){var h=new Connection(d.id,a);h.setPath(b,c,e,f),h.setColor(g),d.connections.push(h)};d3.map(f.upperTasks,function(b,f){c(d);var h={x:0,y:0},i={x:0,y:0},j={x:0,y:0},k={x:0,y:0};0===d.connections.length||0===f?(h.x=d.box.x,h.y=d.box.y+a.box.height/2):(h.x=d.connections[f-1].interStart.x,h.y=d.connections[f-1].interStart.y-a.box.height/2),b.isExternal()&&0!==f&&(h.y=h.y-a.label.height/2),i.x=b.box.x+b.box.width,i.y=b.box.y+a.box.height/2,j.x=f>0?h.x-a.getPerUnit():h.x-a.sectionCurrentIncomingCounts[e]*a.getPerUnit(),j.y=h.y,k.x=j.x,k.y=i.y,b.isExternal()&&(k=j,i.x=k.x,i.y=-a.svg.padding+a.progressBar.height),g(b.id,h,j,k,i,b.color)}),d3.map(f.lowerTasks,function(b,h){var i={x:0,y:0},j={x:0,y:0},k={x:0,y:0},l={x:0,y:0};if(h+=f.upperTasks.length,0===d.connections.length||h===f.upperTasks.length?(i.x=d.box.x-a.sectionCurrentIncomingCounts[e]*a.getPerUnit(),i.y=d.box.y):(c(d),i.x=d.connections[h-1].interStart.x,i.y=d.connections[h-1].interStart.y+(h-f.upperTasks.length)*a.box.height),j.x=b.box.x+b.box.width,j.y=b.box.y+a.box.height/2,k.x=h>0?i.x-a.getPerUnit():i.x-a.sectionCurrentIncomingCounts[e]*a.getPerUnit(),k.y=i.y,l.x=k.x,l.y=j.y,b.isDownStream()){i.x=d.box.x+d.box.width,i.y=d.box.y+a.box.height/2;var m=a.svg.width-2*a.svg.padding;k.x=i.x+(a.sectionCurrentIncomingCounts[e]||1)*(a.getPerUnit()/2),k.x>m&&(k.x=i.x+8),k.y=i.y,l=k,j.x=l.x,j.y=a.svg.height-$(Utils.parseId(BREADCUM_ID)).height()-$("."+CSS_CLASS.CHART_HEADER).height()-2*a.svg.padding;var n=Utils.getTask(b.source),o=n.color||b.color,p={x:j.x+8,y:j.y-a.box.height*a.sectionCurrentIncomingCounts[e],className:o,desc:b.desc,source:n.id,stroke:b.color};k.x>m&&(p.x-=a.label.width+16)}g(b.id,i,k,l,j,b.color)})}),a.drawConnections();var d=$(".connection-label");d.appendTo(d.parent())}},Roadmap.prototype.resetChart=function(){var a=this;$("."+CSS_CLASS.CHART).remove(),a.startDates=[],a.sectionCurrentIncomingCounts=[],a.activeTasks=[],a.downStreamCounts=[]},Roadmap.prototype.drawChart=function(a){var b=this,c=Utils.getLocationHash();c&&(a=c),a=a||roadmapTasks[0].id;var d=Utils.getTask(a);return b.resetChart(),b.prepareChart(),b.updateBreadcum(d),b.updateChartHeader(d),Utils.isDesktopScreen()?(b.prepareBoxes(d),b.prepareConnections(d),b.drawProgressBar(d),void b.updateSvgDimensions()):b.drawMobileChart(d)},Roadmap.prototype.updateNav=function(a){a=a||roadmapTasks[0].id;var b=Utils.getTask(a);b.nav.mouseClick(),$(".roadmapNav").removeClass("open")},Roadmap.prototype.addFeatures=function(a){var b={sub:[],reliedOn:[],relyThis:[]},c=$(Utils.parseId(MOBILE_CHART_ID)),d=function(a){$(Utils.parseId(a)).is(Utils.parseId(a))||c.append(Utils.createDiv(a,["features-list"]))},e=function(a,b){$(Utils.parseId(b)).is(Utils.parseId(b))&&$(Utils.parseId(b)).append('<h3 class="features-list-h">'+a+"</h3>")},f=function(a,b,c){d(c),e(a,c);var f=$("#"+c);d3.map(b,function(a){var b=Utils.getTask(a.taskId),c=b.name,d=b.color,e=null;a.type!==TASK_FEATURE_TYPE.SUB_FEATURES&&(e=Utils.getTask(b.source),c=e&&e.name?e.name:b.source.replace(/_/g," ")),a.type===TASK_FEATURE_TYPE.RELY_THIS_FEATURES&&(e=Utils.getTask(b.source),d=e?e.color:b.color);var g=Utils.createDiv(a.id,["features-list-i",CSS_CLASS.FEATURES+d]);g.text(c),g.on("click",a.onClick()),f.append(g)})};d3.map(roadmapTasks,function(c){return c.parent&&-1===c.id.indexOf(MVP_ID)?c.parent.id===a.id&&c.isExternal()?b.reliedOn.push(new TaskFeature(c.id,TASK_FEATURE_TYPE.RELIED_ON_FEATURES)):c.parent.id===a.id&&c.isDownStream()?b.relyThis.push(new TaskFeature(c.id,TASK_FEATURE_TYPE.RELY_THIS_FEATURES)):c.parent.id===a.id?b.sub.push(new TaskFeature(c.id,TASK_FEATURE_TYPE.SUB_FEATURES)):void 0:void 0
}),b.sub.length>0&&f("Sub features:",b.sub,SUB_FEATURES_ID),b.reliedOn.length>0&&f("Features relied on:",b.reliedOn,RELIED_ON_FEATURES_ID),b.relyThis.length>0&&f("Features relying on this:",b.relyThis,RELY_THIS_FEATURES_ID)},Roadmap.prototype.setMobileView=function(){var a=Utils.createDiv(MOBILE_CHART_ID,["roadmapChartMobile-b"]);$(Utils.parseId(CHART_ID)).append(a)},Roadmap.prototype.resetMobileView=function(){$(Utils.parseId(MOBILE_CHART_ID)).remove()},Roadmap.prototype.drawMobileChart=function(a){var b=this;b.resetMobileView(),b.setMobileView(),b.addFeatures(a)},Roadmap.prototype.draw=function(){var a=this;init(a),$(Utils.parseId(a.targetId)).empty(),a.prepareTasks(),a.setNav(),a.drawChart(),a.updateNav(Utils.getLocationHash())},$(function(){$.get("data/roadmapData.json",function(a){new Roadmap({data:a,target:"#Roadmap",interval:10}).draw()})});